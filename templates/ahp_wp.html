<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <title>AHP ‚Üí WP ‚Äî Sistem Pendukung Keputusan</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='sawstyle.css') }}">
</head>
<body>
  <div class="card">
    <h2>üé¨ Sistem Pendukung Keputusan ‚Äì AHP ‚Üí WP</h2>

    <h3>1Ô∏è‚É£ Matriks Pairwise Kriteria</h3>
    <form method="post" id="ahpWpForm">
      <table border="1" cellpadding="6">
        <tr>
          <th></th>
          {% for c in criteria_names %}<th>{{ c }}</th>{% endfor %}
        </tr>
        {% for i in range(criteria_names|length) %}
          <tr>
            <th>{{ criteria_names[i] }}</th>
            {% for j in range(criteria_names|length) %}
              <td><input type="number" step="any" name="c_{{i}}_{{j}}" value="{{ '%.4f' % default_pairwise[i][j] }}"></td>
            {% endfor %}
          </tr>
        {% endfor %}
      </table>

      <h3 style="margin-top:20px;">2Ô∏è‚É£ Data Film</h3>
      <div style="display:flex;gap:12px;flex-wrap:wrap;">
        <div>
          <label>Jumlah Kandidat</label>
          <input type="number" name="kandidat" id="kandidat" value="3" min="1">
        </div>
        <div style="flex:1">
          <label>Cost Flags (0=Benefit, 1=Cost)</label>
          <input type="text" name="cost_flags" value="0,0,0,0,0">
        </div>
        <div style="flex:0 0 160px;display:flex;align-items:end">
          <button type="button" onclick="buildForm()">Buat Form Input</button>
        </div>
      </div>

      <div id="formContainer" style="margin-top:20px;"></div>

      <div style="text-align:right;margin-top:16px">
        <button type="submit" class="btn ahp">Proses AHP ‚Üí WP</button>
        <a href="/" class="btn wp">Kembali</a>
      </div>
    </form>

    {% if error %}
      <hr><b style="color:#b91c1c">Error:</b> {{ error }}
    {% endif %}

    {% if ranking %}
      <hr>
      <h3>‚öñÔ∏è Bobot Kriteria dari AHP</h3>
      <table border="1" cellpadding="6">
        <tr><th>Kriteria</th>{% for c in criteria_names %}<th>{{ c }}</th>{% endfor %}</tr>
        <tr><td>Bobot (AHP)</td>{% for w in criteria_weights %}<td>{{ "%.4f"|format(w) }}</td>{% endfor %}</tr>
      </table>
      <p class="muted">Œªmax = {{ "%.4f"|format(crit_det.lambda_max) }},
         CI = {{ "%.4f"|format(crit_det.CI) }},
         CR = {{ "%.4f"|format(crit_det.CR) }}</p>

      <h3>üìã Matriks Keputusan (Nilai Film)</h3>
      <table border="1" cellpadding="6">
        <tr><th>Film</th><th>C1</th><th>C2</th><th>C3</th><th>C4</th><th>C5</th></tr>
        {% for row in matrix_input %}
          <tr><td>{{ row.name }}</td>{% for v in row.vals %}<td>{{ v }}</td>{% endfor %}</tr>
        {% endfor %}
      </table>

      <h3>üî¢ Eksponen (per kriteria) dan Nilai S<sub>i</sub> / V<sub>i</sub></h3>
      <table border="1" cellpadding="6">
        <tr><th>Kriteria</th>{% for c in criteria_names %}<th>{{ c }}</th>{% endfor %}</tr>
        <tr><td>Eksponen</td>{% for e in exponents %}<td>{{ "%.6f"|format(e) }}</td>{% endfor %}</tr>
      </table>

      <table border="1" cellpadding="6" style="margin-top:12px">
        <tr><th>Film</th><th>S<sub>i</sub></th><th>V<sub>i</sub></th></tr>
        {% for i in range(names|length) %}
          <tr>
            <td>{{ names[i] }}</td>
            <td>{{ "%.6f"|format(S[i]) }}</td>
            <td><b>{{ "%.6f"|format(V[i]) }}</b></td>
          </tr>
        {% endfor %}
      </table>

      <h3>üèÜ Ranking Akhir</h3>
      <table border="1" cellpadding="6">
        <tr><th>Peringkat</th><th>Nama Film</th><th>Nilai Akhir (V)</th></tr>
        {% for r in ranking %}
          <tr><td>{{ loop.index }}</td><td>{{ r.name }}</td><td><b>{{ "%.6f"|format(r.score) }}</b></td></tr>
        {% endfor %}
      </table>
    {% endif %}
  </div>

  <script>
    function buildForm(){
      const n = parseInt(document.getElementById("kandidat").value) || 0;
      const container = document.getElementById("formContainer");
      container.innerHTML = "";
      if (n <= 0) return;

      let html = `<table border="1" cellpadding="6">
        <thead><tr><th>No</th><th>Nama Film</th><th>Genre</th><th>Rating IMDb</th><th>Rating Usia</th><th>Durasi</th><th>Tahun Rilis</th></tr></thead><tbody>`;
      for (let i=1; i<=n; i++){
        html += `<tr><td>${i}</td>
          <td><input type='text' name='nama_${i}' value='Film ${i}' required></td>
          <td>
            <select name='film_${i}_c1'>
              <option value='9'>Aksi</option><option value='9'>Superhero</option><option value='9'>Komedi</option>
              <option value='7'>Drama</option><option value='7'>Sci-fi</option><option value='7'>Thriller</option>
              <option value='5'>Documentary</option><option value='5'>Art House</option>
            </select>
          </td>
          <td><input type='number' step='0.1' min='0' max='10' placeholder='IMDb' oninput='convertRating(this,${i})'><input type='hidden' name='film_${i}_c2' id='C2_${i}'></td>
          <td>
            <select name='film_${i}_c3'>
              <option value='9'>SU</option><option value='7'>13+</option>
              <option value='5'>17+</option><option value='3'>21+</option>
            </select>
          </td>
          <td><input type='number' placeholder='menit' oninput='convertDuration(this,${i})'><input type='hidden' name='film_${i}_c4' id='C4_${i}'></td>
          <td>
            <select name='film_${i}_c5'>
              <option value='9'>&gt;2010</option><option value='7'>2000‚Äì2010</option><option value='5'>&lt;2000</option>
            </select>
          </td></tr>`;
      }
      html += "</tbody></table>";
      container.innerHTML = html;
    }

    function convertRating(input,i){
      const v=parseFloat(input.value);let s=0;
      if(isNaN(v)){ s = 0; }
      else if(v<6.9)s=5;else if(v<7.5)s=7;else if(v<8.8)s=9;else s=10;
      document.getElementById(`C2_${i}`).value=s;
    }
    function convertDuration(input,i){
      const v=parseFloat(input.value);let s=0;
      if(isNaN(v)){ s = 0; }
      else if(v<60)s=3;else if(v<=90)s=5;else if(v<=150)s=9;else s=7;
      document.getElementById(`C4_${i}`).value=s;
    }
    window.addEventListener("load",()=>buildForm());
  </script>
</body>
</html>
