<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>SPK Pemilihan Film Terbaik untuk Nobar Kampus</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='sawstyle.css') }}">
</head>
<body>
  <div class="card">
    <h2>üé• Sistem Pendukung Keputusan ‚Äì Pemilihan Film Nobar Kampus</h2>
    <p><b>Kriteria:</b></p>
    <ul>
      <li><b>C1:</b> Genre (Aksi/Superhero/Komedi=9, Drama/Sci-fi/Thriller=7, Documentary/Art House=5)</li>
      <li><b>C2:</b> Rating IMDb ‚Üí &lt;6.9=5, &lt;7.5=7, &lt;8.8=9, ‚â•8.8=10</li>
      <li><b>C3:</b> Rating Usia (SU=9, 13+=7, 17+=5, 21+=3)</li>
      <li><b>C4:</b> Durasi (menit) ‚Üí &lt;60=3, 60‚Äì90=5, 90‚Äì150=9, &gt;150=7</li>
      <li><b>C5:</b> Tahun Rilis ‚Üí &gt;2010=9, 2000‚Äì2010=7, &lt;2000=5</li>
    </ul>

    <hr>

    <form method="post">
      <div style="display:flex;gap:12px;flex-wrap:wrap;">
        <div><label>Jumlah Film:</label><input type="number" id="kandidat" name="kandidat" value="3" min="1" required></div>
        <div style="flex:1">
          <label>Bobot (C1..C5):</label>
          <input type="text" name="bobot" 
            value="{{ weights|join(',') if weights else '0.3,0.2,0.2,0.2,0.1' }}" required>
        </div>
        <div style="flex:0 0 160px;display:flex;align-items:end">
          <button type="button" onclick="buildForm()">Buat Form Input</button>
        </div>
      </div>
      <div id="formContainer" style="margin-top:20px;"></div>
      <div style="text-align:right;margin-top:20px;">
        <button type="submit">Proses SAW</button>
      </div>
    </form>

    {% if matrix_input %}
    <hr>
    <h3>üìã 1Ô∏è‚É£ Matriks Keputusan (Nilai Awal)</h3>
    <table border="1" cellpadding="6">
      <tr><th>Film</th><th>C1</th><th>C2</th><th>C3</th><th>C4</th><th>C5</th></tr>
      {% for row in matrix_input %}
      <tr><td>{{ row.name }}</td>{% for v in row.vals %}<td>{{ v }}</td>{% endfor %}</tr>
      {% endfor %}
    </table>

    <h3>üìä 2Ô∏è‚É£ Nilai Maksimum Tiap Kriteria</h3>
    <table border="1" cellpadding="6"><tr>{% for v in max_vals %}<td><b>{{ v }}</b></td>{% endfor %}</tr></table>

    <h3>üìà 3Ô∏è‚É£ Normalisasi</h3>
    <table border="1" cellpadding="6">
      <tr><th>Film</th><th>C1</th><th>C2</th><th>C3</th><th>C4</th><th>C5</th></tr>
      {% for row in norm %}
      <tr><td>{{ row.name }}</td>{% for v in row.vals %}<td>{{ "%.4f"|format(v) }}</td>{% endfor %}</tr>
      {% endfor %}
    </table>

    <h3>‚öôÔ∏è 4Ô∏è‚É£ Perhitungan Bobot √ó Normalisasi (Vi)</h3>
    <table border="1" cellpadding="6">
      <tr><th>Film</th><th>C1</th><th>C2</th><th>C3</th><th>C4</th><th>C5</th><th><b>Vi</b></th></tr>
      {% for row in weighted %}
      <tr>
        <td>{{ row.name }}</td>
        {% for v in row.vals %}<td>{{ "%.4f"|format(v) }}</td>{% endfor %}
        <td><b>{{ "%.4f"|format(row.vi) }}</b></td>
      </tr>
      {% endfor %}
    </table>

    <h3>üèÜ 5Ô∏è‚É£ Ranking Akhir</h3>
    <table border="1" cellpadding="6">
      <tr><th>Peringkat</th><th>Nama Film</th><th>Nilai Akhir</th></tr>
      {% for r in ranking %}
      <tr><td>{{ loop.index }}</td><td>{{ r.name }}</td><td><b>{{ "%.4f"|format(r.score) }}</b></td></tr>
      {% endfor %}
    </table>
    {% endif %}
  </div>

  <script>
    function buildForm(){
      const n = parseInt(document.getElementById("kandidat").value) || 0;
      const container = document.getElementById("formContainer");
      container.innerHTML = "";
      if (n <= 0) return;

      let html = `<table border="1" cellpadding="6">
        <thead><tr><th>No</th><th>Nama Film</th><th>Genre</th><th>Rating IMDb</th><th>Rating Usia</th><th>Durasi</th><th>Tahun Rilis</th></tr></thead><tbody>`;
      for (let i=1; i<=n; i++){
        html += `<tr><td>${i}</td>
          <td><input type='text' name='nama_${i}' required></td>
          <td>
            <select name='c_${i}_1'>
              <option value='9'>Aksi</option><option value='9'>Superhero</option><option value='9'>Komedi</option>
              <option value='7'>Drama</option><option value='7'>Sci-fi</option><option value='7'>Thriller</option>
              <option value='5'>Documentary</option><option value='5'>Art House</option>
            </select>
          </td>
          <td><input type='number' step='0.1' min='0' max='10' placeholder='IMDb'
              oninput='convertRating(this,${i})'><input type='hidden' name='c_${i}_2' id='C2_${i}'></td>
          <td>
            <select name='c_${i}_3'>
              <option value='9'>SU</option><option value='7'>13+</option>
              <option value='5'>17+</option><option value='3'>21+</option>
            </select>
          </td>
          <td><input type='number' placeholder='menit' oninput='convertDuration(this,${i})'><input type='hidden' name='c_${i}_4' id='C4_${i}'></td>
          <td>
            <select name='c_${i}_5'>
              <option value='9'>&gt;2010</option><option value='7'>2000‚Äì2010</option><option value='5'>&lt;2000</option>
            </select>
          </td></tr>`;
      }
      html += "</tbody></table>";
      container.innerHTML = html;
    }

    function convertRating(input,i){
      const v=parseFloat(input.value);let s=0;
      if(v<6.9)s=5;else if(v<7.5)s=7;else if(v<8.8)s=9;else s=10;
      document.getElementById(`C2_${i}`).value=s;
    }

    function convertDuration(input,i){
      const v=parseFloat(input.value);let s=0;
      if(v<60)s=3;else if(v<=90)s=5;else if(v<=150)s=9;else s=7;
      document.getElementById(`C4_${i}`).value=s;
    }

    window.addEventListener("load",()=>buildForm());
  </script>
</body>
</html>
