<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <title>AHP ‚Äî Sistem Pendukung Keputusan</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='sawstyle.css') }}">
  <style>
    .box { margin-bottom:12px;padding:8px;border:1px solid #ddd; }
    .muted { color:#666;font-size:0.9em }
    table { border-collapse:collapse; margin-bottom:12px; }
    td, th { padding:6px;border:1px solid #ccc; text-align:center; }
    .small { font-size:0.9em; color:#444; }
    /* üåü bagian detail alternatif disembunyikan dulu */
    #altDetails {
      display: none;
      margin-top: 20px;
      animation: fadeIn 0.3s ease-in-out;
    }
    @keyframes fadeIn {
      from {opacity:0; transform:translateY(-5px);}
      to {opacity:1; transform:translateY(0);}
    }
    .toggle-btn {
      background: #2563eb;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 6px;
      cursor: pointer;
    }
    .toggle-btn:hover {
      background: #1e40af;
    }
  </style>
</head>
<body>
  <div class="card">
    <h2>üé¨ Sistem Pendukung Keputusan ‚Äì Pemilihan Film Nobar Kampus (Metode AHP)</h2>

    <form method="post">
      <h3>‚ø° Input Matriks Perbandingan Kriteria (5√ó5)</h3>
      <p class="muted">Saran: C2 paling penting, lalu C1, C3/C4/C5 sama level. Ubah bila perlu.</p>

      <!-- ‚úÖ hanya satu tabel input pairwise dengan default -->
      <table>
        <tr><th></th>{% for c in criteria_names %}<th>{{ c }}</th>{% endfor %}</tr>
        {% for i in range(criteria_names|length) %}
        <tr>
          <th>{{ criteria_names[i] }}</th>
          {% for j in range(criteria_names|length) %}
            {% set val = default_pairwise[i][j] if default_pairwise is defined else '' %}
            <td>
              <input style="width:90px;text-align:center" type="number" step="any"
                     name="c_{{i}}_{{j}}" value="{{ val }}">
            </td>
          {% endfor %}
        </tr>
        {% endfor %}
      </table>

      <div style="text-align:right;margin-top:20px;">
        <button type="submit">Proses AHP</button>
      </div>
    </form>

    {% if error %}
      <hr><b style="color:#b91c1c">Error:</b> {{ error }}
    {% endif %}

    {% if crit_matrix %}
      <hr>
      <h3>üîπ Matriks Pairwise Kriteria (A<sub>crit</sub>)</h3>
      <table>
        <tr><th></th>{% for c in criteria_names %}<th>{{ c }}</th>{% endfor %}</tr>
        {% for i in range(criteria_names|length) %}
          <tr><th>{{ criteria_names[i] }}</th>{% for j in range(criteria_names|length) %}<td>{{ "%.6f"|format(crit_matrix[i][j]) }}</td>{% endfor %}</tr>
        {% endfor %}
      </table>

      <h3>üî∏ Aproks dari Matrix Power (kriteria)</h3>
      <div class="small">M¬≤ (Acrit √ó Acrit)</div>
      <table>
        {% for row in crit_power.M2 %}
          <tr>{% for v in row %}<td>{{ "%.6f"|format(v) }}</td>{% endfor %}</tr>
        {% endfor %}
      </table>

      <p class="small"><b>Jumlah baris (M¬≤):</b>
        {% for v in crit_power.row_sums_m2 %} {{ "%.6f"|format(v) }} {% endfor %}
      </p>
      <p class="small"><b>Eigen aproks (dari M¬≤ ‚Äî eig_m2):</b>
        {% for v in crit_power.eig_m2 %} <b>{{ "%.6f"|format(v) }}</b> {% endfor %}
      </p>

      <div class="small">M‚Å¥ (M¬≤ √ó M¬≤)</div>
      <table>
        {% for row in crit_power.M4 %}
          <tr>{% for v in row %}<td>{{ "%.6f"|format(v) }}</td>{% endfor %}</tr>
        {% endfor %}
      </table>

      <p class="small"><b>Jumlah baris (M‚Å¥):</b>
        {% for v in crit_power.row_sums_m4 %} {{ "%.6f"|format(v) }} {% endfor %}
      </p>
      <p class="small"><b>Eigen aproks (dari M‚Å¥ ‚Äî eig_m4):</b>
        {% for v in crit_power.eig_m4 %} <b>{{ "%.6f"|format(v) }}</b> {% endfor %}
      </p>

      <p class="small"><b>Selisih (eig_m2 - eig_m4):</b>
        {% for v in crit_power.diff %} {{ "%.6f"|format(v) }} {% endfor %}
      </p>

      <h3>üìä Bobot Kriteria (final, dari aproks M‚Å¥)</h3>
      <p>
        {% for v in criteria_weights %}<b>{{ "%.6f"|format(v) }}</b> {% endfor %}
      </p>

      <h3>üè∑ Ranking Kriteria</h3>
      <table>
        <tr><th>Peringkat</th><th>Kriteria</th><th>Bobot</th></tr>
        {% set pairs = [] %}
        {% for i in range(criteria_names|length) %}
          {% set _ = pairs.append((criteria_names[i], criteria_weights[i])) %}
        {% endfor %}
        {% for item in pairs|sort(attribute=1, reverse=True) %}
          <tr><td>{{ loop.index }}</td><td>{{ item[0] }}</td><td>{{ "%.6f"|format(item[1]) }}</td></tr>
        {% endfor %}
      </table>
    {% endif %}

    {% if criteria_weights %}
      <hr>
      <h3>üìà Ranking Akhir Film (10 Alternatif)</h3>
      <table>
        <tr><th>Peringkat</th><th>Nama Film</th><th>Nilai</th></tr>
        {% for r in ranking %}
          <tr><td>{{ loop.index }}</td><td>{{ r.name }}</td><td><b>{{ "%.6f"|format(r.score) }}</b></td></tr>
        {% endfor %}
      </table>

      <!-- üü¢ tombol untuk menampilkan detail perhitungan alternatif -->
      <div style="text-align:right;">
        <button class="toggle-btn" id="toggleAlt">Lihat Detail Perhitungan Alternatif ‚¨áÔ∏è</button>
      </div>

      <!-- üåü bagian detail disembunyikan dulu -->
      <div id="altDetails">
        <div class="card">
          <h2>üìä Detail Perhitungan Alternatif (Metode AHP)</h2>

          <h3>üß© Matriks Pairwise & Eigen (per kriteria) ‚Äî alternatif (10√ó10)</h3>
          {% for block in alt_blocks %}
            <div class="box">
              <b>Kriteria C{{ block.k + 1 }} ‚Äî {{ criteria_names[block.k] }}</b>
              <div class="muted">Matriks Pairwise Alternatif</div>
              <table>
                <tr><th></th>{% for a in alternatives %}<th>{{ a }}</th>{% endfor %}</tr>
                {% for i in range(alternatives|length) %}
                  <tr><th>{{ alternatives[i] }}</th>{% for j in range(alternatives|length) %}<td>{{ "%.4f"|format(block.A[i][j]) }}</td>{% endfor %}</tr>
                {% endfor %}
                <tr><th>Jumlah Kolom</th>{% for s in block.col_sums %}<td>{{ "%.6f"|format(s) }}</td>{% endfor %}</tr>
              </table>

              <div class="muted">M¬≤ (alternatif)</div>
              <table>
                {% for row in block.M2 %}
                  <tr>{% for v in row %}<td>{{ "%.4f"|format(v) }}</td>{% endfor %}</tr>
                {% endfor %}
              </table>
              <p>Jumlah baris (M¬≤): {% for v in block.row_sums_m2 %} <b>{{ "%.6f"|format(v) }}</b> {% endfor %}</p>
              <p><b>Eigen aproks (M¬≤):</b> {% for v in block.eig_m2 %} <b>{{ "%.6f"|format(v) }}</b> {% endfor %}</p>

              <div class="muted">M‚Å¥ (alternatif)</div>
              <table>
                {% for row in block.M4 %}
                  <tr>{% for v in row %}<td>{{ "%.4f"|format(v) }}</td>{% endfor %}</tr>
                {% endfor %}
              </table>
              <p>Jumlah baris (M‚Å¥): {% for v in block.row_sums_m4 %} <b>{{ "%.6f"|format(v) }}</b> {% endfor %}</p>
              <p><b>Eigen aproks (M‚Å¥) ‚Äî bobot lokal:</b> {% for v in block.alt_priority %} <b>{{ "%.6f"|format(v) }}</b> {% endfor %}</p>

              <div class="muted">Bobot lokal dari raw (referensi)</div>
              <table>
                <tr><th>Alternatif</th><th>Local ws (raw ‚Üí normalisasi)</th></tr>
                {% for i in range(alternatives|length) %}
                  <tr><td>{{ alternatives[i] }}</td><td>{{ "%.6f"|format(block.local_ws_from_raw[i]) }}</td></tr>
                {% endfor %}
              </table>
            </div>
          {% endfor %}

          <h3>üìà Matriks Prioritas Alternatif (10√ó5) ‚Äî kolom = kriteria</h3>
          <table>
            <tr><th>Alternatif</th>{% for c in criteria_names %}<th>{{ c }}</th>{% endfor %}<th>Skor Global</th></tr>
            {% for i in range(alternatives|length) %}
              <tr>
                <td>{{ alternatives[i] }}</td>
                {% for j in range(criteria_names|length) %}
                  <td>{{ "%.6f"|format(alt_priority_matrix[i][j]) }}</td>
                {% endfor %}
                <td><b>{{ "%.6f"|format(global_scores[i]) }}</b></td>
              </tr>
            {% endfor %}
          </table>

          <h3>üèÜ Ranking Akhir</h3>
          <table>
            <tr><th>Peringkat</th><th>Nama Film</th><th>Nilai</th></tr>
            {% for r in ranking %}
              <tr><td>{{ loop.index }}</td><td>{{ r.name }}</td><td><b>{{ "%.6f"|format(r.score) }}</b></td></tr>
            {% endfor %}
          </table>
        </div>
      </div>
    {% endif %}
  </div>

  <!-- üß† script toggle -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const btn = document.getElementById('toggleAlt');
      const details = document.getElementById('altDetails');
      if (btn && details) {
        btn.addEventListener('click', () => {
          if (details.style.display === 'none' || details.style.display === '') {
            details.style.display = 'block';
            btn.textContent = 'Sembunyikan Detail Perhitungan Alternatif ‚¨ÜÔ∏è';
          } else {
            details.style.display = 'none';
            btn.textContent = 'Lihat Detail Perhitungan Alternatif ‚¨áÔ∏è';
          }
        });
      }
    });
  </script>
</body>
</html>
